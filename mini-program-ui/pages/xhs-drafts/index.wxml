<view class="page page-xhs">
  <view class="container">
    <view class="hero fade-up">
      <text class="title">草稿库</text>
      <text class="subtitle">历史草稿与发布记录</text>
    </view>

    <view class="section fade-up delay-1">
      <text class="section-title">最近草稿</text>

      <view wx:if="{{loading}}" class="card">
        <text class="muted small">加载中...</text>
      </view>

      <view wx:if="{{!loading && !drafts.length}}" class="card">
        <text class="muted small">暂无草稿。去小红书工坊生成第一条吧。</text>
        <button class="btn-primary" bindtap="handleGoWorkshop">去工坊</button>
      </view>

      <view
        wx:for="{{drafts}}"
        wx:key="id"
        class="card"
        bindtap="handleOpenDraft"
        data-id="{{item.id}}"
        style="margin-top: 16rpx;"
      >
        <view class="row space-between">
          <text class="card-title">{{item.title}}</text>
          <text class="tag {{item.status === 'published' ? 'tag-success' : ''}}">{{item.statusLabel}}</text>
        </view>

        <text class="muted small">{{item.createdAtLabel}} · {{item.riskLabel}}</text>

        <image wx:if="{{item.coverAbs}}" src="{{item.coverAbs}}" mode="widthFix" class="cover-image" />

        <view class="row" style="margin-top: 12rpx;">
          <button class="btn-outline" size="mini" data-id="{{item.id}}" catchtap="handleCopyContent">复制文案</button>
          <button class="btn-primary" size="mini" data-id="{{item.id}}" catchtap="handleOpenDraft">继续编辑</button>
        </view>

        <view wx:if="{{item.publish_url}}" style="margin-top: 12rpx;">
          <text class="muted small">发布链接</text>
          <text class="small" style="margin-top: 6rpx; display: block;">{{item.publish_url}}</text>
          <view class="row" style="margin-top: 10rpx;">
            <button class="btn-outline" size="mini" data-url="{{item.publish_url}}" catchtap="handleCopyUrl">复制链接</button>
          </view>
          <image wx:if="{{item.qrAbs}}" src="{{item.qrAbs}}" mode="widthFix" class="cover-image" />
        </view>
      </view>
    </view>
  </view>
</view>
